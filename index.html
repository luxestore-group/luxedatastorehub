<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <title>LUXE DATASTORE | Official</title>

    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        :root {
            --gold: #d4af37;
            --gold-light: #fcf6ba;
            --whatsapp: #25D366;
            --bg-dark: radial-gradient(circle at top right, #1a1a2e, #16213e, #0f3460, #000000);
            --bg-light: radial-gradient(circle at top right, #f3e7e9, #e3eeff, #ffffff);
            --text-dark: white;
            --text-light: #1a1a2e;
        }

        body {
            background: var(--bg-dark);
            background-attachment: fixed;
            color: var(--text-dark);
            font-family: 'Inter', sans-serif;
            transition: background 0.5s ease, color 0.5s ease;
        }

        /* LIGHT MODE OVERRIDES */
        body.light-mode {
            background: var(--bg-light);
            color: var(--text-light);
        }

        body.light-mode .glass-card {
            background: rgba(255, 255, 255, 0.6);
            border: 1px solid rgba(0, 0, 0, 0.05);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.1);
        }

        body.light-mode .text-gray-400 { color: #555; }
        body.light-mode .text-white { color: #000; }
        body.light-mode .btn-premium,
        body.light-mode .wa-pulse,
        body.light-mode .bg-red-600,
        body.light-mode .bg-green-600 { color: #000; }

        body.light-mode .bg-white\/5 { background-color: rgba(0,0,0,0.05); }
        body.light-mode .bg-white\/10 { background-color: rgba(0,0,0,0.1); }
        body.light-mode .border-white\/10 { border-color: rgba(0,0,0,0.1); }

        /* PREMIUM GLASSMORPHISM */
        .glass-card {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.8);
            transition: background 0.3s ease, border-color 0.3s ease;
        }

        /* ADMIN DASHBOARD SPECIFIC */
        .admin-panel {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(20px);
        }
        body.light-mode .admin-panel {
            background: rgba(255, 255, 255, 0.95);
        }

        /* SHIMMER TEXT EFFECT */
        .shimmer {
            background: linear-gradient(to right, #d4af37 20%, #fcf6ba 40%, #fcf6ba 60%, #d4af37 80%);
            background-size: 200% auto;
            color: #000;
            background-clip: text;
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            animation: shine 3s linear infinite;
        }

        @keyframes shine {
            to { background-position: 200% center; }
        }

        /* WHATSAPP PULSE */
        .wa-pulse {
            animation: waPulse 2s infinite;
        }
        @keyframes waPulse {
            0% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0.4); }
            70% { box-shadow: 0 0 0 15px rgba(37, 211, 102, 0); }
            100% { box-shadow: 0 0 0 0 rgba(37, 211, 102, 0); }
        }

        /* BUTTONS */
        .btn-premium {
            background: linear-gradient(135deg, var(--gold), #aa771c);
            color: #000;
            font-weight: 800;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        .btn-premium:hover {
            transform: translateY(-2px);
            filter: brightness(1.2);
            box-shadow: 0 5px 15px rgba(212, 175, 55, 0.4);
        }

        /* SLIDE UP ANIMATION */
        .animate-up {
            animation: slideUp 0.8s cubic-bezier(0.2, 0.8, 0.2, 1) forwards;
            opacity: 0;
        }
        @keyframes slideUp {
            from { transform: translateY(30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        /* STATUS BADGES */
        .status-pending { background: #eab308; color: black; }
        .status-processing { background: #3b82f6; color: white; }
        .status-delivered { background: #22c55e; color: white; }

        /* COPY SUCCESS ANIMATION */
        .copy-flash {
            color: #4ade80 !important;
            transform: scale(1.2);
        }

        /* MUST READ BANNER */
        .must-read-title { color: #ffd700; font-weight: 900; letter-spacing: 0.02em; }
        .must-read-text { color: #fff; }
    </style>
</head>
<body class="min-h-screen">

    <div id="toast-wrap" class="fixed top-5 left-1/2 -translate-x-1/2 z-[300] space-y-2"></div>

    <div id="auth-page" class="min-h-screen flex items-center justify-center p-6">
        <div class="glass-card p-10 rounded-3xl w-full max-w-md text-center animate-up">
            <div class="w-20 h-20 bg-black/50 border border-yellow-500/30 rounded-full flex items-center justify-center mx-auto mb-6 shadow-2xl">
                <i class="fa-solid fa-gem text-3xl shimmer"></i>
            </div>
            <h1 class="text-3xl font-black tracking-tighter shimmer mb-2 italic">LUXE DATASTORE</h1>
            <p class="text-gray-400 text-xs uppercase tracking-[0.3em] mb-10">Exclusive Access</p>

            <div id="login-box" class="space-y-4">
                <input type="email" id="l-email" placeholder="Email" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl focus:outline-none focus:border-yellow-500 transition text-inherit">
                <input type="password" id="l-pass" placeholder="Password" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl focus:outline-none focus:border-yellow-500 transition text-inherit">
                <button onclick="login()" class="w-full btn-premium p-4 rounded-xl">SIGN IN</button>
                <p class="text-sm text-gray-500 mt-4 cursor-pointer" onclick="toggleAuth(true)">New here? <span class="text-yellow-500">Create Account</span></p>
            </div>

            <div id="signup-box" class="hidden space-y-4">
                <input type="email" id="s-email" placeholder="Email" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl focus:outline-none focus:border-yellow-500 transition text-inherit">
                <input type="password" id="s-pass" placeholder="Password" class="w-full bg-white/5 border border-white/10 p-4 rounded-xl focus:outline-none focus:border-yellow-500 transition text-inherit">
                <div class="flex items-center bg-black/40 p-3 rounded-xl border border-white/10">
                    <span id="cap-txt" class="flex-1 text-yellow-500 font-bold"></span>
                    <input type="number" id="cap-in" placeholder="?" class="w-16 bg-transparent text-center border-b border-yellow-500 outline-none text-white">
                </div>
                <button onclick="signup()" class="w-full btn-premium p-4 rounded-xl">REGISTER</button>
                <p class="text-sm text-gray-500 mt-4 cursor-pointer" onclick="toggleAuth(false)">Back to <span class="text-yellow-500">Login</span></p>
            </div>
        </div>
    </div>

    <div id="main-app" class="hidden">
        <nav class="glass-card sticky top-0 z-50 px-4 md:px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <i class="fa-solid fa-gem text-yellow-500"></i>
                <span class="text-sm md:text-xl font-black tracking-tighter shimmer">LUXE DATASTORE</span>
            </div>
            <div class="flex items-center gap-3 md:gap-4">
                <button onclick="toggleTheme()" class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center hover:bg-white/20 transition">
                    <i id="theme-icon" class="fa-solid fa-moon text-yellow-500"></i>
                </button>

                <div class="relative cursor-pointer" onclick="toggleNotifications()">
                    <i class="fa-solid fa-bell text-gray-400 hover:text-white transition text-lg"></i>
                    <span id="notif-dot" class="absolute -top-1 -right-1 bg-red-600 w-2.5 h-2.5 rounded-full hidden border border-black"></span>
                </div>

                <div class="cursor-pointer" onclick="openUserDashboard()">
                    <i class="fa-solid fa-user-circle text-gray-400 hover:text-yellow-500 transition text-xl"></i>
                </div>

                <button id="admin-btn" onclick="openAdmin()" class="hidden bg-red-600 text-[10px] font-bold px-3 py-1 rounded text-white shadow-lg hover:bg-red-700 transition">ADMIN</button>

                <div class="relative cursor-pointer hover:scale-110 transition" onclick="showCart()">
                    <i class="fa-solid fa-basket-shopping text-xl text-gray-400"></i>
                    <span id="cart-count" class="absolute -top-2 -right-2 bg-yellow-500 text-black text-[9px] font-bold w-4 h-4 rounded-full flex items-center justify-center hidden">0</span>
                </div>

                <button onclick="logout()"><i class="fa-solid fa-power-off text-gray-500 hover:text-red-500 transition"></i></button>
            </div>
        </nav>

        <div id="notif-panel" class="fixed top-20 right-4 md:right-20 w-80 glass-card rounded-2xl hidden z-[150] animate-up border-yellow-500/20 max-h-[400px] overflow-y-auto">
            <div class="p-4 border-b border-white/10 bg-black/40 backdrop-blur-md sticky top-0 flex justify-between items-center">
                <span class="font-bold text-sm">System Alerts</span>
                <button onclick="toggleNotifications()" class="text-xs text-gray-500"><i class="fa-solid fa-times"></i></button>
            </div>
            <div id="notif-list" class="p-2 space-y-2">
                <div class="text-center text-gray-500 text-xs py-4">No new notifications</div>
            </div>
        </div>

        <div class="p-6">
            <div class="max-w-4xl mx-auto flex flex-wrap gap-4 justify-center">
                <a href="https://chat.whatsapp.com/IcZbC84gPQYCqMYpVpaVWZ" target="_blank" class="wa-pulse bg-green-600 hover:bg-green-500 text-white font-bold px-6 py-3 rounded-full flex items-center gap-2 transition duration-300">
                    <i class="fa-brands fa-whatsapp text-xl"></i>
                    <span>Join Official Group</span>
                </a>
                <button onclick="startHelp()" class="bg-white/5 border border-white/10 hover:bg-white/10 px-6 py-3 rounded-full flex items-center gap-2 transition">
                    <i class="fa-solid fa-circle-question text-blue-400"></i>
                    <span>Instructions</span>
                </button>
            </div>

            <div class="max-w-4xl mx-auto mt-6">
                <div class="glass-card p-4 rounded-2xl border border-yellow-500/20">
                    <h3 class="must-read-title text-lg mb-2">MUST READ</h3>
                    <p class="must-read-text font-bold mb-2">USER MUST CONFIRM ORDER BEFORE PAYMENT ON THE SITE TO ENSURE SMOOTH DELIVERY!!</p>
                    <ul class="must-read-text text-sm space-y-1">
                        <li>• All products are ready for delivery.</li>
                        <li>• Users must provide correct info before and after payment.</li>
                        <li>• TURBONET / BROADBAND SIMs do not work for this type of data bundles.</li>
                        <li>• Purchase for wrong numbers are non-refundable.</li>
                        <li>• Data bundle delivery: 30 mins – 1 hr (2hrs max) for only DATABUNDLES.</li>
                    </ul>
                </div>
            </div>

        </div>

        <div class="px-6 pb-24">
            <h2 class="text-center text-gray-400 text-xs uppercase tracking-[0.5em] mb-8">Premium Bundles</h2>
            <div id="bundle-grid" class="max-w-6xl mx-auto grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            </div>
        </div>

        <div class="fixed bottom-6 right-6 flex flex-col gap-4 z-[100]">
            <a href="https://wa.me/233548164533" target="_blank" class="w-14 h-14 bg-white/10 border border-white/20 backdrop-blur-xl rounded-full flex items-center justify-center text-white shadow-2xl hover:bg-green-600 transition">
                <i class="fa-solid fa-headset text-2xl"></i>
            </a>
            <button onclick="toggleBot()" class="w-14 h-14 btn-premium rounded-full flex items-center justify-center text-2xl shadow-2xl wa-pulse">
                <i class="fa-solid fa-robot"></i>
            </button>
        </div>
    </div>

    <div id="user-dashboard" class="fixed inset-0 z-[200] hidden bg-black/95 backdrop-blur-md p-6 overflow-y-auto">
        <div class="max-w-3xl mx-auto glass-card rounded-3xl p-8 animate-up mt-10">
            <div class="flex justify-between items-start mb-8">
                <div>
                    <h2 class="text-3xl font-black shimmer">MY ACCOUNT</h2>
                    <div class="flex items-center gap-2 mt-2">
                        <div class="w-3 h-3 bg-green-500 rounded-full animate-pulse"></div>
                        <span class="text-green-500 text-xs font-bold uppercase tracking-widest">Signed In</span>
                    </div>
                </div>
                <button onclick="closeUserDashboard()" class="w-10 h-10 rounded-full bg-white/10 hover:bg-white/20 flex items-center justify-center"><i class="fa-solid fa-times"></i></button>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-10">
                <div class="bg-white/5 p-6 rounded-2xl border border-white/10">
                    <p class="text-gray-400 text-xs uppercase">Email Address</p>
                    <p id="user-dash-email" class="text-lg font-bold text-inherit mt-1">...</p>
                </div>
                <div class="bg-white/5 p-6 rounded-2xl border border-white/10">
                    <p class="text-gray-400 text-xs uppercase">Account ID</p>
                    <p id="user-dash-id" class="text-xs font-mono text-yellow-500 mt-1 truncate">...</p>
                </div>
            </div>

            <h3 class="text-xl font-bold mb-4 border-b border-white/10 pb-2">Order History</h3>
            <div id="user-history-list" class="space-y-3">
                <div class="text-center text-gray-500 py-6">Loading history...</div>
            </div>
        </div>
    </div>

    <div id="admin-dashboard" class="fixed inset-0 z-[250] hidden admin-panel overflow-y-auto animate-up">
        <div class="p-6 max-w-7xl mx-auto">
            <div class="flex justify-between items-center mb-8 border-b border-white/10 pb-4">
                <div>
                    <h1 class="text-3xl font-black shimmer">ADMIN DASHBOARD</h1>
                    <p class="text-gray-400 text-xs uppercase tracking-widest">Workflow Management</p>
                </div>
                <div class="flex items-center gap-4">
                    <input id="admin-search" oninput="searchOrders(this.value)" type="text" placeholder="Search order id e.g. 123456" class="bg-white/5 rounded-xl p-2 outline-none text-sm border border-white/10" />
                    <button onclick="clearAllOrders()" class="text-xs bg-red-600/20 text-red-500 px-3 py-2 rounded hover:bg-red-600 hover:text-white transition">Clear All Orders</button>
                    <button onclick="closeAdmin()" class="bg-white/10 hover:bg-white/20 text-white px-4 py-2 rounded-xl transition">
                        <i class="fa-solid fa-times mr-2"></i> Close
                    </button>
                </div>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mb-8">
                <div class="bg-blue-900/20 border border-blue-500/30 p-6 rounded-2xl">
                    <p class="text-blue-400 text-xs uppercase font-bold">Total Orders</p>
                    <h3 id="stat-total" class="text-3xl font-bold mt-2">0</h3>
                </div>
                <div class="bg-yellow-900/20 border border-yellow-500/30 p-6 rounded-2xl">
                    <p class="text-yellow-400 text-xs uppercase font-bold">Pending Actions</p>
                    <h3 id="stat-pending" class="text-3xl font-bold mt-2">0</h3>
                </div>
                <div class="bg-green-900/20 border border-green-500/30 p-6 rounded-2xl">
                    <p class="text-green-400 text-xs uppercase font-bold">Delivered</p>
                    <h3 id="stat-delivered" class="text-3xl font-bold mt-2">0</h3>
                </div>
            </div>

            <div class="glass-card p-6 rounded-2xl mb-8 border border-yellow-500/20">
                <h4 class="font-bold text-lg mb-4 text-yellow-500"><i class="fa-solid fa-bullhorn mr-2"></i>Global Broadcast</h4>
                <div class="flex gap-4">
                    <input type="text" id="broadcast-msg" placeholder="Type a message to all users..." class="flex-1 bg-black/40 border border-white/10 rounded-xl p-3 text-white outline-none focus:border-yellow-500">
                    <button onclick="sendBroadcast()" class="btn-premium px-6 rounded-xl text-sm">SEND</button>
                </div>
            </div>

            <div class="glass-card rounded-2xl overflow-hidden">
                <div class="p-4 bg-white/5 border-b border-white/10 font-bold flex justify-between items-center">
                    <span>Recent Orders</span>
                    <button onclick="fetchOrders()" class="text-xs bg-white/10 px-2 py-1 rounded hover:bg-white/20"><i class="fa-solid fa-rotate"></i> Refresh</button>
                </div>
                <div id="admin-orders-list" class="divide-y divide-white/10">
                    <div class="p-8 text-center text-gray-500">Loading orders...</div>
                </div>
            </div>
        </div>
    </div>

    <div id="order-modal" class="fixed inset-0 bg-black/95 backdrop-blur-md z-[200] hidden flex items-center justify-center p-6">
        <div class="glass-card p-8 rounded-3xl w-full max-w-sm animate-up">
            <h3 class="text-2xl font-bold shimmer mb-6 text-center">Recipient Details</h3>
            <div id="order-info" class="bg-white/5 p-4 rounded-2xl mb-6 border border-white/10 text-inherit"></div>
            <div class="mb-6">
                <label class="text-[10px] uppercase text-gray-500 ml-1">Recipient Number</label>
                <input type="tel" id="order-phone" placeholder="05XXXXXXXX" class="w-full bg-black/50 border border-white/10 p-4 rounded-xl text-yellow-500 font-bold focus:border-yellow-500 outline-none">
            </div>
            <button id="confirm-pay-btn" onclick="proceedToPayment('single')" class="w-full btn-premium p-4 rounded-xl flex items-center justify-center gap-2">
                PROCEED TO PAY <i class="fa-solid fa-arrow-right"></i>
            </button>
            <button onclick="closeModals()" class="w-full mt-4 text-gray-500 text-sm py-2">Go Back</button>
        </div>
    </div>

    <div id="cart-modal" class="fixed inset-0 bg-black/95 backdrop-blur-md z-[200] hidden flex items-center justify-center p-6">
        <div class="glass-card p-8 rounded-3xl w-full max-w-sm animate-up flex flex-col max-h-[90vh]">
            <div class="flex justify-between items-center mb-6">
                <h3 class="text-2xl font-bold shimmer">My Bag</h3>
                <button onclick="clearCart()" class="text-red-500 text-xs uppercase font-bold">Clear All</button>
            </div>

            <div id="cart-items-list" class="flex-1 overflow-y-auto space-y-3 mb-6 pr-2">
            </div>

            <div class="border-t border-white/10 pt-4 mb-4">
                <div class="flex justify-between items-center text-lg font-bold">
                    <span>Total</span>
                    <span id="cart-total-price" class="text-yellow-500">GHC 0</span>
                </div>
            </div>

            <div class="mb-6">
                <label class="text-[10px] uppercase text-gray-500 ml-1">Recipient Number</label>
                <input type="tel" id="cart-phone" placeholder="05XXXXXXXX" class="w-full bg-black/50 border border-white/10 p-4 rounded-xl text-yellow-500 font-bold focus:border-yellow-500 outline-none">
            </div>

            <button onclick="proceedToPayment('cart')" class="w-full btn-premium p-4 rounded-xl flex items-center justify-center gap-2">
                PROCEED TO PAY <i class="fa-solid fa-arrow-right"></i>
            </button>
            <button onclick="closeModals()" class="w-full mt-4 text-gray-500 text-sm py-2">Continue Shopping</button>
        </div>
    </div>

    <div id="payment-modal" class="fixed inset-0 bg-black/95 backdrop-blur-md z-[220] hidden flex items-center justify-center p-4">
        <div class="glass-card p-6 rounded-3xl w-full max-w-md animate-up border border-yellow-500/20 relative">
            <div class="absolute top-4 right-4 text-red-500 font-bold bg-white/10 px-3 py-1 rounded-lg" id="timer">10:00</div>

            <h3 class="text-xl font-bold shimmer mb-2">Complete Payment</h3>
            <p class="text-xs text-gray-400 mb-6">Send exact amount to the account below.</p>

            <div class="space-y-4 mb-6">
                <div class="bg-white/5 p-3 rounded-xl flex justify-between items-center border border-white/10">
                    <div>
                        <p class="text-[10px] text-gray-500 uppercase">Account Name</p>
                        <p class="font-bold text-white text-sm" id="pay-name">ASANTE JUDE OSEI</p>
                    </div>
                    <button onclick="copyToClip('ASANTE JUDE OSEI', this)" class="text-yellow-500 p-2"><i class="fa-regular fa-copy"></i></button>
                </div>

                <div class="bg-white/5 p-3 rounded-xl flex justify-between items-center border border-white/10">
                    <div>
                        <p class="text-[10px] text-gray-500 uppercase">MoMo Number</p>
                        <p class="font-bold text-yellow-400 text-xl tracking-wider" id="pay-number">0548164533</p>
                    </div>
                    <button onclick="copyToClip('0548164533', this)" class="text-yellow-500 p-2"><i class="fa-regular fa-copy"></i></button>
                </div>

                <div class="bg-white/5 p-3 rounded-xl flex justify-between items-center border border-white/10">
                    <div>
                        <p class="text-[10px] text-gray-500 uppercase">Amount to Send</p>
                        <p class="font-bold text-white text-lg" id="pay-amount">GHC 0.00</p>
                    </div>
                    <button onclick="copyToClipAmount(this)" class="text-yellow-500 p-2"><i class="fa-regular fa-copy"></i></button>
                </div>

                <div class="bg-blue-900/20 p-3 rounded-xl flex justify-between items-center border border-blue-500/30">
                    <div>
                        <p class="text-[10px] text-blue-400 uppercase font-bold">Reference ID (Required)</p>
                        <p class="font-mono text-white text-sm" id="pay-ref">...</p>
                    </div>
                    <button onclick="copyToClipRef(this)" class="text-blue-400 p-2"><i class="fa-regular fa-copy"></i></button>
                </div>
            </div>

            <a href="tel:*170%23" class="block w-full bg-white/10 hover:bg-white/20 text-center py-3 rounded-xl mb-4 text-sm font-bold transition border border-white/10">
                <i class="fa-solid fa-phone mr-2"></i> Dial *170#
            </a>

            <button id="i-paid-btn" onclick="confirmPayment()" class="w-full btn-premium p-4 rounded-xl flex items-center justify-center gap-2 shadow-lg shadow-yellow-500/20">
                I HAVE SENT THE MONEY <i class="fa-solid fa-check-double"></i>
            </button>
            <button onclick="closeModals()" class="w-full mt-4 text-gray-500 text-xs text-center hover:text-white">Cancel Transaction</button>
        </div>
    </div>

    <div id="bot-ui" class="fixed bottom-24 right-6 w-80 h-[450px] glass-card rounded-3xl hidden flex flex-col z-[200] overflow-hidden border border-yellow-500/20">
        <div class="bg-gradient-to-r from-yellow-600 to-yellow-400 p-4 text-black font-bold flex justify-between">
            <span>LUXE HELPER</span>
            <button onclick="toggleBot()"><i class="fa-solid fa-times"></i></button>
        </div>
        <div id="chat-box" class="flex-1 p-4 overflow-y-auto space-y-4 text-sm bg-black/40"></div>
        <div class="p-4 bg-white/5 border-t border-white/10 flex gap-2">
            <input type="text" id="bot-input" placeholder="Ask a question..." class="flex-1 bg-transparent outline-none text-white">
            <button onclick="sendBot()" class="text-yellow-500"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
    </div>

    <script>
        // FIREBASE SETUP
        const firebaseConfig = {
            apiKey: "AIzaSyClKMg44mmRlpvw6awlpU4J-ZcR-IY6SPg",
            authDomain: "zicci-556ac.firebaseapp.com",
            projectId: "zicci-556ac",
            storageBucket: "zicci-556ac.firebasestorage.app",
            messagingSenderId: "615854052458",
            appId: "1:615854052458:web:9d76d0d61fc449a81fa613"
        };
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();

        // ADMIN UID
        const ADMIN_ID = "VuJUYF69VCUBzo0y5mnrkAGgBqj1";
        function isAdmin(){ return currentUser && currentUser.uid === ADMIN_ID; }

        const HARPOON_API_KEY = "hpn_live_sk_spUhtbnQoB2WKaOIKpfqC8pxVRuBXxFK";
        const HARPOON_VERIFY_URL = "https://api.harpoonpay.com/v1/transactions/verify"; 
        const PAYMENT_NUMBER = "0548164533";
        const ACCOUNT_NAME = "ASANTE JUDE OSEI";

        const bundles = [
            { id: 1, name: '1GB', price: 6, hot: false },
            { id: 2, name: '2GB', price: 12, hot: false },
            { id: 3, name: '3GB', price: 18, hot: false },
            { id: 4, name: '5GB', price: 30, hot: false },
            { id: 6, name: '6GB', price: 36, hot: true },
            { id: 7, name: '7GB', price: 42, hot: false },
            { id: 8, name: '8GB', price: 50, hot: true },
            { id: 9, name: '9GB', price: 54, hot: false },
            { id: 5, name: '10GB', price: 60, hot: false }
        ];

        let cart = [];
        let activeProduct = null;
        let cSum = 0;
        let isDarkMode = true;
        let currentUser = null;

        let currentOrderData = null;
        let timerInterval = null;

        // UPDATED REF GENERATION (NUMBERS ONLY)
        function genRef() {
            return Math.floor(100000 + Math.random() * 900000).toString();
        }

        function toggleTheme() {
            isDarkMode = !isDarkMode;
            const body = document.body;
            const icon = document.getElementById('theme-icon');
            if (!isDarkMode) {
                body.classList.add('light-mode');
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
            } else {
                body.classList.remove('light-mode');
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
            }
        }

        function toast(msg, type='info') {
            const wrap = document.getElementById('toast-wrap');
            const div = document.createElement('div');
            div.className = `p-4 rounded-2xl border-l-4 shadow-2xl flex items-center gap-3 animate-up min-w-[280px] ${type === 'error' ? 'bg-red-900 border-red-500 text-white' : 'bg-gray-900 border-yellow-500 text-white'}`;
            div.innerHTML = `<i class="fa-solid ${type === 'error' ? 'fa-circle-x' : 'fa-circle-check text-yellow-500'}"></i> <span class="text-sm font-medium">${msg}</span>`;
            wrap.appendChild(div);
            setTimeout(() => { div.style.opacity = '0'; setTimeout(() => div.remove(), 500); }, 3000);
        }

        auth.onAuthStateChanged(user => {
            currentUser = user;
            if (user) {
                document.getElementById('auth-page').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                renderBundles();
                initNotifications();
                if(user.uid === ADMIN_ID) {
                    document.getElementById('admin-btn').classList.remove('hidden');
                } else {
                    document.getElementById('admin-btn').classList.add('hidden');
                }
            } else {
                document.getElementById('auth-page').classList.remove('hidden');
                document.getElementById('main-app').classList.add('hidden');
                genCap();
            }
        });

        function toggleAuth(signup) {
            document.getElementById('login-box').classList.toggle('hidden', signup);
            document.getElementById('signup-box').classList.toggle('hidden', !signup);
        }

        function genCap() {
            const a = Math.floor(Math.random()*9)+1, b = Math.floor(Math.random()*9)+1;
            cSum = a + b;
            document.getElementById('cap-txt').innerText = `${a} + ${b} = ?`;
        }

        function login() {
            const e = document.getElementById('l-email').value, p = document.getElementById('l-pass').value;
            auth.signInWithEmailAndPassword(e,p).catch(err => toast(err.message, 'error'));
        }

        function signup() {
            const e = document.getElementById('s-email').value, p = document.getElementById('s-pass').value, c = parseInt(document.getElementById('cap-in').value);
            if(c !== cSum) return toast("Math error!", "error");
            auth.createUserWithEmailAndPassword(e,p).catch(err => toast(err.message, 'error'));
        }

        function logout() { auth.signOut(); }

        function openUserDashboard() {
            if(!currentUser) return;
            document.getElementById('user-dashboard').classList.remove('hidden');
            document.getElementById('user-dash-email').innerText = currentUser.email;
            document.getElementById('user-dash-id').innerText = currentUser.uid;
            fetchUserHistory();
        }

        function closeUserDashboard() {
            document.getElementById('user-dashboard').classList.add('hidden');
        }

        function fetchUserHistory() {
            const list = document.getElementById('user-history-list');
            db.collection('orders').where('uid', '==', currentUser.uid).orderBy('time', 'desc').limit(20).get()
            .then(snap => {
                if(snap.empty) {
                    list.innerHTML = '<div class="text-center text-gray-500">No previous orders found</div>';
                    return;
                }
                list.innerHTML = '';
                snap.forEach(doc => {
                    const o = doc.data();
                    const d = new Date(o.time).toLocaleDateString();
                    list.innerHTML += `
                        <div class="bg-white/5 border border-white/10 p-4 rounded-xl flex justify-between items-center">
                            <div>
                                <p class="text-xs text-yellow-500 font-mono">#${o.ref}</p>
                                <p class="text-sm font-bold text-white">${o.product}</p>
                                <p class="text-[10px] text-gray-500">${d} • ${o.recipient}</p>
                            </div>
                            <span class="text-[10px] px-2 py-1 rounded-full uppercase font-bold status-${o.status}">${o.status}</span>
                        </div>
                    `;
                });
            });
        }

        function renderBundles() {
            const grid = document.getElementById('bundle-grid');
            grid.innerHTML = bundles.map(b => `
                <div class="glass-card p-6 rounded-3xl relative overflow-hidden group hover:scale-[1.02] transition duration-300">
                    ${b.hot ? '<div class="absolute -right-8 top-4 bg-yellow-500 text-black text-[10px] font-black px-10 py-1 rotate-45 shadow-lg">HOT</div>' : ''}
                    <div class="flex justify-between items-start mb-6">
                        <div class="w-12 h-12 bg-yellow-500/10 rounded-2xl flex items-center justify-center text-yellow-500">
                            <i class="fa-solid fa-signal text-xl"></i>
                        </div>
                        <div class="text-right">
                            <p class="text-[10px] text-gray-400 uppercase tracking-widest">Pricing</p>
                            <p class="text-2xl font-black text-inherit">GHC ${b.price}</p>
                        </div>
                    </div>
                    <h3 class="text-xl font-bold mb-1">${b.name} Data</h3>
                    <p class="text-xs text-gray-500 mb-6">Valid for 30 Days • No Expiry</p>
                    <div class="flex gap-2">
                        <button onclick="openOrderModal(${b.id})" class="flex-1 btn-premium py-3 rounded-xl text-xs">BUY NOW</button>
                        <button onclick="addToCart(${b.id})" class="w-12 bg-white/5 hover:bg-white/10 rounded-xl flex items-center justify-center transition border border-white/10">
                            <i class="fa-solid fa-cart-plus text-yellow-500"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function addToCart(id) {
            const b = bundles.find(x => x.id === id);
            cart.push(b);
            updateCartUI();
            toast(`${b.name} added to bag`);
        }

        function updateCartUI() {
            const count = document.getElementById('cart-count');
            count.innerText = cart.length;
            count.classList.toggle('hidden', cart.length === 0);
        }

        function showCart() {
            const list = document.getElementById('cart-items-list');
            const totalEl = document.getElementById('cart-total-price');
            list.innerHTML = '';
            let total = 0;

            if(cart.length === 0) {
                list.innerHTML = '<p class="text-center text-gray-500 py-10">Your bag is empty</p>';
            } else {
                cart.forEach((item, idx) => {
                    total += item.price;
                    list.innerHTML += `
                        <div class="bg-white/5 p-3 rounded-xl flex justify-between items-center border border-white/10">
                            <div>
                                <p class="font-bold text-sm">${item.name} Package</p>
                                <p class="text-xs text-yellow-500">GHC ${item.price}</p>
                            </div>
                            <button onclick="removeFromCart(${idx})" class="text-red-500 p-2"><i class="fa-solid fa-trash-can"></i></button>
                        </div>
                    `;
                });
            }
            totalEl.innerText = `GHC ${total}`;
            document.getElementById('cart-modal').classList.remove('hidden');
        }

        function removeFromCart(idx) {
            cart.splice(idx, 1);
            showCart();
            updateCartUI();
        }

        function clearCart() {
            cart = [];
            showCart();
            updateCartUI();
        }

        function openOrderModal(id) {
            activeProduct = bundles.find(b => b.id === id);
            document.getElementById('order-info').innerHTML = `
                <p class="text-xs text-gray-400 uppercase">Selected Plan</p>
                <p class="text-xl font-bold">${activeProduct.name} - GHC ${activeProduct.price}</p>
            `;
            document.getElementById('order-modal').classList.remove('hidden');
        }

        function closeModals() {
            document.querySelectorAll('#order-modal, #cart-modal, #payment-modal').forEach(m => m.classList.add('hidden'));
            clearInterval(timerInterval);
        }

        function proceedToPayment(type) {
            let phone, amount, productLabel;

            if(type === 'single') {
                phone = document.getElementById('order-phone').value;
                if(!phone || phone.length < 10) return toast("Valid number required", "error");
                amount = activeProduct.price;
                productLabel = activeProduct.name;
            } else {
                phone = document.getElementById('cart-phone').value;
                if(!phone || phone.length < 10) return toast("Valid number required", "error");
                if(cart.length === 0) return toast("Cart is empty", "error");
                amount = cart.reduce((s, i) => s + i.price, 0);
                productLabel = cart.map(i => i.name).join(', ');
            }

            const ref = genRef();
            currentOrderData = {
                uid: currentUser.uid,
                email: currentUser.email,
                product: productLabel,
                amount: amount,
                recipient: phone,
                ref: ref,
                status: 'pending',
                time: Date.now()
            };

            document.getElementById('pay-amount').innerText = `GHC ${amount.toFixed(2)}`;
            document.getElementById('pay-ref').innerText = ref;
            
            document.getElementById('order-modal').classList.add('hidden');
            document.getElementById('cart-modal').classList.add('hidden');
            document.getElementById('payment-modal').classList.remove('hidden');

            startTimer(600);
        }

        function startTimer(sec) {
            clearInterval(timerInterval);
            const el = document.getElementById('timer');
            timerInterval = setInterval(() => {
                let m = Math.floor(sec/60), s = sec % 60;
                el.innerText = `${m}:${s < 10 ? '0'+s : s}`;
                if(sec <= 0) { clearInterval(timerInterval); closeModals(); toast("Payment timed out", "error"); }
                sec--;
            }, 1000);
        }

        function copyToClip(text, btn) {
            navigator.clipboard.writeText(text);
            const icon = btn.querySelector('i');
            icon.className = 'fa-solid fa-check copy-flash';
            setTimeout(() => icon.className = 'fa-regular fa-copy', 2000);
        }
        function copyToClipAmount(btn) {
            const amt = currentOrderData.amount.toFixed(2);
            copyToClip(amt, btn);
        }
        function copyToClipRef(btn) {
            copyToClip(currentOrderData.ref, btn);
        }

        async function confirmPayment() {
            const btn = document.getElementById('i-paid-btn');
            btn.innerHTML = '<i class="fa-solid fa-circle-notch animate-spin"></i> VERIFYING...';
            btn.disabled = true;

            db.collection('orders').add(currentOrderData)
            .then(() => {
                toast("Order logged! Our team will verify and deliver shortly.");
                if(currentOrderData.product.includes(',')) cart = []; updateCartUI();
                closeModals();
            })
            .catch(err => {
                toast("Error: " + err.message, "error");
                btn.innerHTML = 'I HAVE SENT THE MONEY <i class="fa-solid fa-check-double"></i>';
                btn.disabled = false;
            });
        }

        function openAdmin() {
            if(!isAdmin()) return;
            document.getElementById('admin-dashboard').classList.remove('hidden');
            fetchOrders();
        }
        function closeAdmin() { document.getElementById('admin-dashboard').classList.add('hidden'); }

        let allOrders = [];
        function fetchOrders() {
            db.collection('orders').orderBy('time', 'desc').limit(100).get().then(snap => {
                allOrders = [];
                snap.forEach(doc => allOrders.push({id: doc.id, ...doc.data()}));
                renderAdminOrders(allOrders);
                updateStats(allOrders);
            });
        }

        function updateStats(orders) {
            document.getElementById('stat-total').innerText = orders.length;
            document.getElementById('stat-pending').innerText = orders.filter(o => o.status === 'pending' || o.status === 'processing').length;
            document.getElementById('stat-delivered').innerText = orders.filter(o => o.status === 'delivered').length;
        }

        function renderAdminOrders(orders) {
            const list = document.getElementById('admin-orders-list');
            if(orders.length === 0) {
                list.innerHTML = '<div class="p-8 text-center text-gray-500">No orders found</div>';
                return;
            }
            list.innerHTML = orders.map(o => `
                <div class="p-4 flex flex-col md:flex-row justify-between gap-4 hover:bg-white/5 transition">
                    <div class="flex-1">
                        <div class="flex items-center gap-3 mb-1">
                            <span class="text-xs font-mono text-yellow-500 font-bold bg-yellow-500/10 px-2 py-0.5 rounded">#${o.ref}</span>
                            <span class="text-[10px] text-gray-500">${new Date(o.time).toLocaleString()}</span>
                        </div>
                        <h4 class="font-bold text-sm text-white">${o.product} • GHC ${o.amount}</h4>
                        <p class="text-xs text-gray-400">Recipient: <span class="text-white font-bold">${o.recipient}</span></p>
                        <p class="text-[10px] text-blue-400">${o.email}</p>
                    </div>
                    <div class="flex items-center gap-2">
                        <select onchange="updateStatus('${o.id}', this.value)" class="bg-black/40 border border-white/10 text-[10px] p-2 rounded outline-none text-white">
                            <option value="pending" ${o.status === 'pending' ? 'selected' : ''}>Pending</option>
                            <option value="processing" ${o.status === 'processing' ? 'selected' : ''}>Processing</option>
                            <option value="delivered" ${o.status === 'delivered' ? 'selected' : ''}>Delivered</option>
                        </select>
                        <button onclick="deleteOrder('${o.id}')" class="w-8 h-8 bg-red-600/20 text-red-500 rounded flex items-center justify-center hover:bg-red-600 hover:text-white transition">
                            <i class="fa-solid fa-trash-can text-xs"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }

        function searchOrders(q) {
            const filtered = allOrders.filter(o => o.ref.toLowerCase().includes(q.toLowerCase()));
            renderAdminOrders(filtered);
        }

        function updateStatus(id, stat) {
            db.collection('orders').doc(id).update({ status: stat })
            .then(() => {
                toast(`Order marked as ${stat}`);
                fetchOrders();
            });
        }

        function deleteOrder(id) {
            if(!confirm("Delete this order?")) return;
            db.collection('orders').doc(id).delete().then(() => fetchOrders());
        }

        async function clearAllOrders() {
            if(!confirm("Are you sure? This will delete EVERY order in the database.")) return;
            const snap = await db.collection('orders').get();
            const batch = db.batch();
            snap.forEach(doc => batch.delete(doc.ref));
            await batch.commit();
            fetchOrders();
        }

        function sendBroadcast() {
            const msg = document.getElementById('broadcast-msg').value;
            if(!msg) return;
            db.collection('notifications').add({
                message: msg,
                time: Date.now(),
                type: 'broadcast'
            }).then(() => {
                toast("Broadcast sent!");
                document.getElementById('broadcast-msg').value = '';
            });
        }

        function initNotifications() {
            db.collection('notifications').orderBy('time', 'desc').limit(5).onSnapshot(snap => {
                const list = document.getElementById('notif-list');
                const dot = document.getElementById('notif-dot');
                if(snap.empty) return;
                
                dot.classList.remove('hidden');
                list.innerHTML = '';
                snap.forEach(doc => {
                    const n = doc.data();
                    list.innerHTML += `
                        <div class="p-3 bg-white/5 rounded-xl border border-white/10 mb-2">
                            <p class="text-xs text-white leading-relaxed">${n.message}</p>
                            <p class="text-[9px] text-gray-500 mt-1">${new Date(n.time).toLocaleTimeString()}</p>
                        </div>
                    `;
                });
            });
        }

        function toggleNotifications() {
            const p = document.getElementById('notif-panel');
            p.classList.toggle('hidden');
            document.getElementById('notif-dot').classList.add('hidden');
        }

        function toggleBot() { document.getElementById('bot-ui').classList.toggle('hidden'); }
        function sendBot() {
            const i = document.getElementById('bot-input'), b = document.getElementById('chat-box');
            if(!i.value) return;
            b.innerHTML += `<div class="text-right"><span class="bg-yellow-500 text-black px-3 py-2 rounded-2xl rounded-tr-none inline-block">${i.value}</span></div>`;
            const q = i.value.toLowerCase(); i.value = '';
            let r = "I'm not sure about that. Please contact support via the headset icon.";
            if(q.includes('price')) r = "Our bundles start from GHC 6 for 1GB up to GHC 60 for 10GB.";
            if(q.includes('how to')) r = "Select a bundle, enter recipient number, pay via MoMo, and click 'I Have Sent Money'.";
            if(q.includes('time') || q.includes('long')) r = "Delivery usually takes 30 mins to 1 hour.";
            setTimeout(() => {
                b.innerHTML += `<div><span class="bg-white/10 text-white px-3 py-2 rounded-2xl rounded-tl-none inline-block">${r}</span></div>`;
                b.scrollTop = b.scrollHeight;
            }, 600);
        }

        function startHelp() {
            const steps = [
                "Welcome! Here's how to use LUXE DATASTORE.",
                "1. Choose your preferred Data Bundle.",
                "2. Enter the recipient's phone number accurately.",
                "3. Pay the EXACT amount shown to our MoMo number.",
                "4. Use the provided Reference ID during payment.",
                "5. Once paid, click 'I HAVE SENT THE MONEY' to notify us."
            ];
            let i = 0;
            const b = document.getElementById('chat-box');
            document.getElementById('bot-ui').classList.remove('hidden');
            const interval = setInterval(() => {
                b.innerHTML += `<div><span class="bg-white/10 text-white px-3 py-2 rounded-2xl rounded-tl-none inline-block">${steps[i]}</span></div>`;
                b.scrollTop = b.scrollHeight;
                i++;
                if(i >= steps.length) clearInterval(interval);
            }, 1000);
        }
    </script>
</body>
</html>
