<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LUXE DATASTORE</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-firestore-compat.js"></script>

    <style>
        /* GOLD & BLACK LUXE THEME */
        :root {
            --gold: #d4af37;
            --dark: #121212;
            --panel: #1e1e1e;
        }
        body { font-family: sans-serif; transition: background 0.3s, color 0.3s; }
        
        /* Dark Mode (Default) */
        body.dark-mode { background-color: var(--dark); color: white; }
        .glass-panel { background: rgba(30, 30, 30, 0.9); border: 1px solid #333; backdrop-filter: blur(10px); }
        
        /* Light Mode */
        body.light-mode { background-color: #f4f4f4; color: #121212; }
        body.light-mode .glass-panel { background: rgba(255, 255, 255, 0.9); border: 1px solid #ccc; }
        body.light-mode .text-gray-400 { color: #555; }

        /* Utilities */
        .gold-text { color: var(--gold); }
        .gold-border { border-color: var(--gold); }
        .btn-gold { background: var(--gold); color: black; font-weight: bold; transition: 0.2s; }
        .btn-gold:hover { transform: scale(1.02); background: #eac14d; }
        
        /* Loading Spinner */
        .loader { border: 4px solid #f3f3f3; border-top: 4px solid var(--gold); border-radius: 50%; width: 24px; height: 24px; animation: spin 1s linear infinite; margin: 0 auto; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* Animations */
        .fade-in { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="dark-mode min-h-screen">

    <div id="auth-page" class="flex flex-col items-center justify-center min-h-screen p-4">
        <div class="glass-panel p-8 rounded-xl w-full max-w-md text-center fade-in shadow-2xl">
            <h1 class="text-4xl font-bold gold-text mb-2">LUXE DATASTORE</h1>
            <p class="text-gray-400 mb-6">Premium Data Bundles</p>

            <div id="login-section">
                <input type="email" id="login-email" placeholder="Email" class="w-full p-3 mb-3 bg-black/30 border border-gray-600 rounded text-white">
                <input type="password" id="login-pass" placeholder="Password" class="w-full p-3 mb-4 bg-black/30 border border-gray-600 rounded text-white">
                <button onclick="login()" class="w-full btn-gold p-3 rounded mb-4">LOGIN</button>
                <p class="text-sm cursor-pointer hover:text-white text-gray-400" onclick="showSignup()">No account? <span class="gold-text">Sign Up</span></p>
            </div>

            <div id="signup-section" class="hidden">
                <input type="email" id="signup-email" placeholder="Email" class="w-full p-3 mb-3 bg-black/30 border border-gray-600 rounded text-white">
                <input type="password" id="signup-pass" placeholder="Create Password" class="w-full p-3 mb-3 bg-black/30 border border-gray-600 rounded text-white">
                
                <div class="flex items-center justify-between mb-4 bg-gray-800 p-2 rounded">
                    <span id="captcha-question" class="font-bold text-white px-2"></span>
                    <input type="number" id="captcha-input" placeholder="?" class="w-16 p-1 text-center bg-black border border-gray-600 rounded text-white">
                </div>

                <button onclick="signup()" class="w-full btn-gold p-3 rounded mb-4">CREATE ACCOUNT</button>
                <p class="text-sm cursor-pointer hover:text-white text-gray-400" onclick="showLogin()">Have an account? <span class="gold-text">Login</span></p>
            </div>
            
            <p id="auth-msg" class="text-red-500 text-sm mt-2"></p>
        </div>
    </div>

    <div id="main-app" class="hidden">
        
        <nav class="glass-panel sticky top-0 z-40 p-4 flex justify-between items-center shadow-lg">
            <div class="font-bold text-xl tracking-wider"><i class="fa-solid fa-gem gold-text"></i> LUXE DATA</div>
            <div class="flex gap-4 items-center">
                <button onclick="toggleTheme()"><i class="fa-solid fa-circle-half-stroke text-xl"></i></button>
                <div class="relative" onclick="showNotifications()">
                    <i class="fa-solid fa-bell text-xl cursor-pointer"></i>
                    <span class="absolute -top-1 -right-1 bg-red-600 w-3 h-3 rounded-full animate-pulse"></span>
                </div>
                <button id="admin-btn" onclick="openAdmin()" class="hidden bg-red-600 text-white text-xs px-2 py-1 rounded font-bold">ADMIN</button>
                <button onclick="logout()" class="text-gray-400 hover:text-red-500"><i class="fa-solid fa-power-off"></i></button>
            </div>
        </nav>

        <div class="flex justify-center gap-4 my-6">
            <a href="https://chat.whatsapp.com/YOUR_GROUP_LINK" target="_blank" class="bg-green-600 px-4 py-2 rounded text-white font-bold text-sm"><i class="fa-brands fa-whatsapp"></i> Join Group</a>
            <button onclick="showCart()" class="bg-gray-700 px-4 py-2 rounded text-white text-sm"><i class="fa-solid fa-cart-shopping"></i> My Cart</button>
            <button onclick="startTutorial()" class="bg-blue-600 px-4 py-2 rounded text-white text-sm"><i class="fa-solid fa-circle-question"></i> Help</button>
        </div>

        <div class="container mx-auto px-4 pb-20">
            <h2 class="text-2xl font-bold mb-6 text-center">Available Bundles</h2>
            <div id="product-list" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                </div>
        </div>

        <button onclick="toggleBot()" class="fixed bottom-4 right-4 bg-gold w-14 h-14 rounded-full shadow-xl flex items-center justify-center text-black z-50 text-2xl hover:scale-110 transition btn-gold">
            <i class="fa-solid fa-robot"></i>
        </button>

        <a href="https://wa.me/233548164533" target="_blank" class="fixed bottom-20 right-4 bg-green-500 w-14 h-14 rounded-full shadow-xl flex items-center justify-center text-white z-50 text-2xl hover:scale-110 transition">
            <i class="fa-solid fa-headset"></i>
        </a>

    </div>

    <div id="order-modal" class="fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center p-4">
        <div class="glass-panel p-6 rounded-xl w-full max-w-sm fade-in">
            <h3 class="text-xl font-bold gold-text mb-4">Confirm Order</h3>
            
            <div id="order-details" class="mb-4 bg-black/40 p-3 rounded"></div>

            <label class="text-xs text-gray-400">Enter Phone Number (Required)</label>
            <input type="tel" id="order-phone" placeholder="05XXXXXXXX" class="w-full p-3 bg-gray-800 border border-gray-600 rounded text-white mb-2">
            
            <p class="text-red-400 text-xs mb-4"><i class="fa-solid fa-triangle-exclamation"></i> Wrong numbers are non-refundable.</p>

            <button onclick="processOrder()" class="w-full btn-gold p-3 rounded mb-2">CONFIRM & ORDER VIA WHATSAPP</button>
            <button onclick="closeModals()" class="w-full bg-gray-700 text-white p-2 rounded">Cancel</button>
        </div>
    </div>

    <div id="rules-modal" class="fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center p-4">
        <div class="glass-panel p-6 rounded-xl w-full max-w-md fade-in border-l-4 border-red-500">
            <h3 class="text-xl font-bold text-red-500 mb-4">MUST READ RULES</h3>
            <ul class="text-sm space-y-2 text-gray-300 mb-6 list-disc pl-5">
                <li>Users must confirm order here before payment.</li>
                <li>Turbonet/Broadband SIMs <strong>do not work</strong>.</li>
                <li>Delivery time: <strong>30 mins - 1 hr</strong>.</li>
                <li>Wrong number purchases are <strong>Non-Refundable</strong>.</li>
                <li>Do not buy twice for the same number simultaneously.</li>
            </ul>
            <button onclick="closeModals()" class="w-full bg-gray-700 text-white p-2 rounded">I Understand</button>
        </div>
    </div>

    <div id="admin-modal" class="fixed inset-0 bg-[#111] hidden z-[60] overflow-y-auto">
        <div class="p-6">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold gold-text">ADMIN DASHBOARD</h2>
                <button onclick="closeModals()" class="bg-red-600 px-4 py-2 rounded text-white">EXIT</button>
            </div>
            
            <input type="text" id="admin-search" onkeyup="searchOrders()" placeholder="Search Order ID or Phone..." class="w-full p-3 bg-gray-800 border border-gray-700 rounded text-white mb-6">

            <div class="overflow-x-auto">
                <table class="w-full text-left text-sm text-gray-400">
                    <thead class="bg-gray-800 text-white uppercase">
                        <tr>
                            <th class="p-3">ID</th>
                            <th class="p-3">Details</th>
                            <th class="p-3">Phone</th>
                            <th class="p-3">Status</th>
                            <th class="p-3">Action</th>
                        </tr>
                    </thead>
                    <tbody id="admin-table-body">
                        </tbody>
                </table>
            </div>
        </div>
    </div>

    <div id="bot-modal" class="fixed bottom-20 right-4 w-72 h-80 glass-panel rounded-xl hidden flex flex-col z-50 shadow-2xl">
        <div class="bg-gold p-2 text-black font-bold flex justify-between">
            <span>AI Helper</span>
            <button onclick="toggleBot()">X</button>
        </div>
        <div id="chat-history" class="flex-1 p-2 overflow-y-auto text-xs space-y-2">
            <div class="bg-gray-700 p-2 rounded text-white">Hello! Ask me about prices or delivery.</div>
        </div>
        <div class="p-2 flex">
            <input type="text" id="chat-input" class="flex-1 bg-black text-white p-1 rounded text-xs">
            <button onclick="sendBotMsg()" class="ml-2 text-gold"><i class="fa-solid fa-paper-plane"></i></button>
        </div>
    </div>

    <div id="cart-modal" class="fixed inset-0 bg-black/90 hidden z-50 flex items-center justify-center p-4">
        <div class="glass-panel p-6 rounded-xl w-full max-w-sm">
            <h3 class="text-lg font-bold gold-text mb-4">My Cart</h3>
            <div id="cart-content" class="text-sm text-gray-300 mb-4">Empty</div>
            <button onclick="closeModals()" class="w-full bg-gray-700 p-2 rounded text-white">Close</button>
        </div>
    </div>

    <script>
        // 1. CONFIGURATION
        const firebaseConfig = {
            apiKey: "AIzaSyClKMg44mmRlpvw6awlpU4J-ZcR-IY6SPg",
            authDomain: "zicci-556ac.firebaseapp.com",
            projectId: "zicci-556ac",
            storageBucket: "zicci-556ac.firebasestorage.app",
            messagingSenderId: "615854052458",
            appId: "1:615854052458:web:9d76d0d61fc449a81fa613"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.firestore();
        const ADMIN_ID = "VuJUYF69VCUBzo0y5mnrkAGgBqj1";

        // Products Data
        const bundles = [
            { id: 1, name: '1GB', price: 6.00 },
            { id: 2, name: '2GB', price: 12.00 },
            { id: 3, name: '3GB', price: 18.00 },
            { id: 4, name: '4GB', price: 24.00 },
            { id: 5, name: '5GB', price: 30.00 },
            { id: 6, name: '6GB', price: 36.00 },
            { id: 7, name: '7GB', price: 42.00 },
            { id: 8, name: '8GB', price: 50.00 },
            { id: 9, name: '9GB', price: 54.00 },
            { id: 10, name: '10GB', price: 60.00 }
        ];

        let cart = [];
        let selectedProduct = null;
        let captchaSum = 0;

        // 2. AUTHENTICATION FUNCTIONS
        auth.onAuthStateChanged(user => {
            if (user) {
                document.getElementById('auth-page').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                loadProducts();
                if (user.uid === ADMIN_ID) {
                    document.getElementById('admin-btn').classList.remove('hidden');
                }
            } else {
                document.getElementById('auth-page').classList.remove('hidden');
                document.getElementById('main-app').classList.add('hidden');
                generateCaptcha();
            }
        });

        function showSignup() {
            document.getElementById('login-section').classList.add('hidden');
            document.getElementById('signup-section').classList.remove('hidden');
            generateCaptcha();
        }
        function showLogin() {
            document.getElementById('signup-section').classList.add('hidden');
            document.getElementById('login-section').classList.remove('hidden');
        }
        
        function generateCaptcha() {
            const a = Math.floor(Math.random() * 10) + 1;
            const b = Math.floor(Math.random() * 10) + 1;
            captchaSum = a + b;
            document.getElementById('captcha-question').innerText = `${a} + ${b} = `;
        }

        function login() {
            const email = document.getElementById('login-email').value;
            const pass = document.getElementById('login-pass').value;
            auth.signInWithEmailAndPassword(email, pass).catch(e => {
                document.getElementById('auth-msg').innerText = e.message;
            });
        }

        function signup() {
            const email = document.getElementById('signup-email').value;
            const pass = document.getElementById('signup-pass').value;
            const captVal = parseInt(document.getElementById('captcha-input').value);

            if (captVal !== captchaSum) {
                document.getElementById('auth-msg').innerText = "Wrong Captcha!";
                return;
            }

            auth.createUserWithEmailAndPassword(email, pass).catch(e => {
                document.getElementById('auth-msg').innerText = e.message;
            });
        }

        function logout() { auth.signOut(); location.reload(); }

        // 3. UI FUNCTIONS
        function toggleTheme() {
            const body = document.body;
            if(body.classList.contains('dark-mode')) {
                body.classList.replace('dark-mode', 'light-mode');
            } else {
                body.classList.replace('light-mode', 'dark-mode');
            }
        }

        function loadProducts() {
            const container = document.getElementById('product-list');
            container.innerHTML = bundles.map(b => `
                <div class="glass-panel p-6 rounded-xl hover:border-[#d4af37] transition relative group">
                    <h3 class="text-4xl font-bold text-white mb-2">${b.name}</h3>
                    <p class="text-xl gold-text mb-4">GHC ${b.price.toFixed(2)}</p>
                    <div class="flex gap-2">
                        <button onclick="addToCart('${b.name}', ${b.price})" class="bg-gray-700 text-white px-4 py-2 rounded flex-1">Add Cart</button>
                        <button onclick="startOrder(${b.id})" class="btn-gold px-4 py-2 rounded flex-1">BUY</button>
                    </div>
                    <button onclick="alert('Instant delivery. Valid for 30 days.')" class="text-xs text-gray-500 mt-2 underline">Details</button>
                </div>
            `).join('');
        }

        function showNotifications() {
            document.getElementById('rules-modal').classList.remove('hidden');
        }

        function closeModals() {
            document.querySelectorAll('.fixed').forEach(el => {
                if(el.id !== 'auth-page') el.classList.add('hidden');
            });
            // Keep main app visible
            if(auth.currentUser) document.getElementById('main-app').classList.remove('hidden');
        }

        // 4. ORDERING SYSTEM
        function startOrder(id) {
            selectedProduct = bundles.find(b => b.id === id);
            document.getElementById('order-details').innerHTML = `
                <p>Bundle: <b>${selectedProduct.name}</b></p>
                <p>Price: <b class="gold-text">GHC ${selectedProduct.price.toFixed(2)}</b></p>
            `;
            document.getElementById('order-phone').value = '';
            document.getElementById('order-modal').classList.remove('hidden');
        }

        function processOrder() {
            const phone = document.getElementById('order-phone').value;
            if(phone.length < 10) { alert('Enter valid phone number'); return; }

            const orderId = 'ORD-' + Math.floor(Math.random() * 1000000);
            const date = new Date().toLocaleString();

            // Save to Firestore
            db.collection('orders').add({
                orderId: orderId,
                bundle: selectedProduct.name,
                price: selectedProduct.price,
                phone: phone,
                status: 'Pending',
                timestamp: firebase.firestore.FieldValue.serverTimestamp()
            });

            // WhatsApp Redirect
            const msg = `*NEW ORDER - LUXE DATA*%0A` +
                        `ID: ${orderId}%0A` +
                        `Bundle: ${selectedProduct.name}%0A` +
                        `Price: GHC ${selectedProduct.price}%0A` +
                        `Phone: ${phone}%0A` +
                        `Time: ${date}`;
            
            window.open(`https://wa.me/233548164533?text=${msg}`, '_blank');
            closeModals();
        }

        // 5. ADMIN PANEL
        function openAdmin() {
            if(auth.currentUser.uid !== ADMIN_ID) return;
            document.getElementById('admin-modal').classList.remove('hidden');
            loadAdminOrders();
        }

        function loadAdminOrders() {
            const tbody = document.getElementById('admin-table-body');
            tbody.innerHTML = '<tr><td colspan="5" class="text-center p-4">Loading...</td></tr>';

            db.collection('orders').orderBy('timestamp', 'desc').onSnapshot(snap => {
                let html = '';
                snap.forEach(doc => {
                    const d = doc.data();
                    let color = d.status === 'Pending' ? 'text-yellow-500' : (d.status === 'Delivered' ? 'text-green-500' : 'text-blue-500');
                    html += `
                        <tr class="border-b border-gray-700 hover:bg-gray-800">
                            <td class="p-3 text-xs font-mono">${d.orderId}</td>
                            <td class="p-3 text-xs">${d.bundle} - GHC ${d.price}</td>
                            <td class="p-3 text-white">${d.phone}</td>
                            <td class="p-3 ${color} font-bold text-xs">${d.status}</td>
                            <td class="p-3">
                                <button onclick="setStatus('${doc.id}', 'Processing')" class="text-blue-400 mr-2"><i class="fa-solid fa-spinner"></i></button>
                                <button onclick="setStatus('${doc.id}', 'Delivered')" class="text-green-400"><i class="fa-solid fa-check"></i></button>
                            </td>
                        </tr>
                    `;
                });
                tbody.innerHTML = html;
            });
        }

        function setStatus(docId, status) {
            db.collection('orders').doc(docId).update({ status: status });
        }

        function searchOrders() {
            const val = document.getElementById('admin-search').value.toLowerCase();
            const rows = document.querySelectorAll('#admin-table-body tr');
            rows.forEach(row => {
                const text = row.innerText.toLowerCase();
                row.style.display = text.includes(val) ? '' : 'none';
            });
        }

        // 6. EXTRAS (Cart, Bot, Tutorial)
        function addToCart(name, price) {
            cart.push({name, price});
            alert('Added to Cart');
        }

        function showCart() {
            const c = document.getElementById('cart-content');
            if(cart.length === 0) c.innerText = "Cart is empty. Buy individually for faster processing.";
            else c.innerHTML = cart.map(i => `<div class="flex justify-between border-b border-gray-700 py-1"><span>${i.name}</span><span>${i.price}</span></div>`).join('');
            document.getElementById('cart-modal').classList.remove('hidden');
        }

        function toggleBot() {
            const b = document.getElementById('bot-modal');
            b.classList.toggle('hidden');
        }

        function sendBotMsg() {
            const inp = document.getElementById('chat-input');
            const txt = inp.value.toLowerCase();
            const hist = document.getElementById('chat-history');
            
            if(!txt) return;
            hist.innerHTML += `<div class="bg-gold text-black p-2 rounded ml-auto max-w-[80%] mb-2">${inp.value}</div>`;
            inp.value = '';

            setTimeout(() => {
                let reply = "Please contact human support via the headset button.";
                if(txt.includes('price')) reply = "1GB is 6.00 GHC. See the list for more.";
                if(txt.includes('time')) reply = "Orders take 30 mins to 1 hour.";
                if(txt.includes('scam')) reply = "We are legit! Join our group.";
                hist.innerHTML += `<div class="bg-gray-700 text-white p-2 rounded mr-auto max-w-[80%] mb-2">${reply}</div>`;
                hist.scrollTop = hist.scrollHeight;
            }, 500);
        }

        function startTutorial() {
            alert("Step 1: Select a Bundle.\nStep 2: Click BUY.\nStep 3: Enter Phone Number.\nStep 4: Confirm to open WhatsApp for payment.");
        }

        // Check for tutorial on first load
        if(!localStorage.getItem('tut_seen')) {
            setTimeout(() => { startTutorial(); localStorage.setItem('tut_seen', 'true'); }, 1500);
        }

    </script>
</body>
</html>
